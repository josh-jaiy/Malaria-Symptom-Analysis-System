{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
  <div class="card shadow p-4 rounded">
    <h2 class="mb-4 text-center">Add Patient Information</h2>
    
    <!-- Display any success or error messages -->
    {% if messages %}
      <div class="alert-section mb-4">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- The form for adding patient data -->
    <form method="POST" class="needs-validation" novalidate>
      {% csrf_token %}
      
      <!-- Age field -->
      <div class="mb-3">
        <label for="age" class="form-label">Age <span class="text-danger">*</span></label>
        <input type="number" class="form-control" id="age" name="age" value="{{ form.age.value }}" required min="0" max="120" placeholder="Enter patient's age">
        <div class="invalid-feedback">Please provide a valid age.</div>
      </div>
      
      <!-- Gender field -->
      <div class="mb-3">
        <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
        <select class="form-select" id="gender" name="gender" required>
          <option disabled selected value="">Choose gender...</option>
          <option value="Male" {% if form.gender.value == "Male" %}selected{% endif %}>Male</option>
          <option value="Female" {% if form.gender.value == "Female" %}selected{% endif %}>Female</option>
          <option value="Other" {% if form.gender.value == "Other" %}selected{% endif %}>Other</option>
        </select>
        <div class="invalid-feedback">Please select a gender.</div>
      </div>
      
      <!-- Malaria Type field (dropdown with choices) -->
      <div class="mb-3">
        <label for="malaria_type" class="form-label">Malaria Type <span class="text-danger">*</span></label>
        <select class="form-control" id="malaria_type" name="malaria_type" required>
          {% for choice in form.malaria_type.field.choices %}
            <option value="{{ choice.0 }}" {% if form.malaria_type.value == choice.0 %}selected{% endif %}>
              {{ choice.1 }}
            </option>
          {% endfor %}
        </select>
        <div class="invalid-feedback">Please select the type of malaria.</div>
      </div>
      
      <!-- Symptoms field (multiple select) -->
      <div class="mb-4">
        <label class="form-label">Symptoms</label>
        <div class="form-check-group">
          {% for symptom in symptoms %}
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="symptoms" id="symptom_{{ symptom.id }}" value="{{ symptom.id }}" 
              {% if symptom.id in form.cleaned_data.symptoms %}checked{% endif %}>
              <label class="form-check-label" for="symptom_{{ symptom.id }}">
                {{ symptom.name }} <small class="text-muted">({{ symptom.description }})</small>
              </label>
            </div>
          {% endfor %}
        </div>
        {% if form.errors.symptoms %}
          <div class="text-danger">{{ form.errors.symptoms }}</div>
        {% endif %}
      </div>
      
      <!-- Submit button -->
      <div class="text-center">
        <button type="submit" class="btn btn-primary btn-lg">Submit</button>
      </div>
    </form>
  </div>
</div>

<!-- Add form validation -->
<script>
  (function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }
        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>

<!-- Custom Styles for UX Enhancements -->
<style>
  .form-check-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.75rem;
  }

  .btn-primary {
    padding: 0.75rem 2rem;
    font-size: 1.15rem;
    font-weight: 500;
  }

  .card {
    background-color: #ffffff;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
  }
  
  .alert {
    font-size: 1rem;
  }

  .btn-close {
    outline: none;
  }
</style>
{% endblock %}
